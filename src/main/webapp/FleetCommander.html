<!doctype html>
<html lang="en" ng-app="fleetCommanderApp">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	
	<title>Fleet Commander</title>
	
	<link rel="shortcut icon" href="resources/img/favicon.ico" type="image/x-icon">
	<link rel="icon" href="resources/img/favicon.ico" type="image/x-icon">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="resources/css/layout.css">
</head>
<body ng-controller="GamesCtrl" ng-keydown="onKeyDown($event)">
	<div class="outer">
		<div class="middle">
			<div id="game-box" class="inner">
				<h1 ng-class="{'hide-on-small': gameScreen === 'ingame'}">Fleet Commander</h1>
				
				<div ng-show="gameScreen === 'home'">
					<p class="paragraph">
						Conquer the universe by growing your own fleet of space fighters
						to invade other player's planets in this turn-based strategy game!
					</p>
					<p class="paragraph">
						You win the game by defeating your opponent fleet commanders
						by taking over their home planets!
					</p>
					
					<form name="gameStartForm">
						<div class="form-group row" ng-class="{'has-error': !gameStartForm.$valid}">
							<div class="col-xs-6 col-xs-offset-3">
								<label for="playerNameInput">Enter your name:</label>
								<input id="playerNameInput" name="playerName" ng-model="playerName" autofocus="autofocus"
									placeholder="e.g. Cpt. Awesome" maxlength="15" required="required" class="form-control" />
							</div>
						</div>
						
						<div>
							<button class="btn btn-default" ng-disabled="!gameStartForm.$valid" ng-click="resumeGame()" ng-if="hasActiveGame()">
								Resume game
							</button>
							<button class="btn btn-default" ng-disabled="!gameStartForm.$valid" ng-click="createNewGame()">
								Start new game!
							</button>
							<button class="btn btn-default" ng-disabled="!gameStartForm.$valid" ng-click="openJoinGameMenu()">
								Join game
						</button>
						</div>
					</form>
				</div>
				
				<div ng-show="gameScreen === 'players'">
					<div class="ingame-screen">
						<div class="outer"><div class="middle">
							<div class="ingame-menu inner form-horizontal">
								<button ng-click="quitGame()" type="button" class="close"><span>&times;</span></button>
								
								<h3>Players</h3>
								
								<div class="form-group">
									<div class="paragraph">
										Other players can join this game by using a code
									</div>
									<div id="join-code" class="text-uppercase paragraph">
										<span ng-repeat="code in activeJoinCodes">{{code}}{{$last ? '' : ', '}}</span>
									</div>
									<div>
										<button class="btn btn-default btn-sm" ng-click="requestJoinCode()" ng-disabled="5 === activeJoinCodes.length">Request code</button>
										<button class="btn btn-default btn-sm" ng-click="addComputerPlayer()" ng-disabled="5 === game.otherPlayers.length"><span class="shortcut">A</span>dd Computer Player</button>
										<div ng-if="requestJoinCodeError" class="error-msg">{{requestJoinCodeError}}</div>
									</div>
								</div>
								
								<div class="form-group row">
									<div class="col-xs-12">
										<div class="player-slot col-xs-6 friendly-foreground">
											<span ng-show="game.me.status !== 'READY'"><i class="glyphicon glyphicon-refresh gly-spin"></i></span>
											<span ng-show="game.me.status === 'READY'"><i class="glyphicon glyphicon-ok"></i></span>
											<span>{{game.me.name}}</span>
										</div>
										<div class="player-slot col-xs-6 enemy-foreground" ng-repeat="otherPlayer in game.otherPlayers track by otherPlayer.name">
											<span ng-show="otherPlayer.status !== 'READY'"><i class="glyphicon glyphicon-refresh gly-spin"></i></span>
											<span ng-show="otherPlayer.status === 'READY'"yer-indicator"><i class="glyphicon glyphicon-ok"></i></span>
											<span>{{otherPlayer.name}}</span>
										</div>
										<div class="player-slot col-xs-6" ng-repeat="i in getNumber(5 - game.otherPlayers.length) track by $index">
											&nbsp;
										</div>
									</div>
								</div>
								
								<div>
									<button class="btn btn-default" ng-click="startGame()" ng-hide="waitingForOtherPlayers"><span class="shortcut">P</span>lay!</button>
									<div ng-if="startGameError" class="error-msg">{{startGameError}}</div>
									<div ng-show="waitingForOtherPlayers"><i class="glyphicon glyphicon-refresh gly-spin"></i> Waiting for other players...</div>
								</div>
							</div>
						</div></div>
					</div>
				</div>
				
				<div ng-show="gameScreen === 'join'">
					<div class="ingame-screen">
						<div class="outer"><div class="middle">
							<div class="ingame-menu inner form-horizontal">
								<button ng-click="gameScreen='home'" type="button" class="close"><span>&times;</span></button>
								
								<h3>Join existing game</h3>
								
								<!-- TODO allow player to use different name, if it wasnt unique (in error case) -->
								
								<form name="joinCodeForm">
									<div class="form-group" ng-class="{'has-error': !joinCodeForm.$valid || joinGameError}">
										<div class="col-xs-6 col-xs-offset-3">
											<label for="codeInput">Enter the join code:</label>
											<input id="codeInput" name="code" ng-model="joiningPlayerCode" autofocus="autofocus" placeholder="e.g. yx45ab" pattern="[A-Za-z0-9]{6}" maxlength="6" required="required" class="form-control"/>
										</div>
										<label for="codeInput" ng-if="joinGameError" class="error-msg">{{joinGameError}}</label>
									</div>
									
									<div class="form-group">
										<button class="btn btn-default" ng-click="tryToJoinGame()" ng-disabled="!joinCodeForm.$valid" type="submit">Join game</button>
										<button class="btn btn-default" ng-click="createNewGame()">Start own game</button>
									</div>
								</form>
							</div>
						</div></div>
					</div>
				</div>
				
				<div ng-show="gameScreen === 'ingame'">
					<div class="game-menu">
						<button class="btn btn-default" ng-click="endTurn()" ng-hide="waitingForOtherPlayers" ng-disabled="blockingActionInProgress || game.status === 'OVER'"><span class="shortcut">E</span>nd turn</button>
						<button class="btn btn-default" ng-click="quitGame()">Quit game</button>
					</div>
					<div class="game-status-bar" ng-class="{'friendly-foreground': game.me.status === 'PLAYING' || game.me.status === 'READY' , 'neutral': game.me.status === 'QUIT' || game.me.status === 'DEFEATED'}">
						<span>{{game.me.name}}</span>
						<span class="pull-right">Credits: {{game.me.credits}}</span>
					</div>
					<div class="ingame-screen">
						<div class="blocking-overlay" ng-show="waitingForOtherPlayers"><i class="glyphicon glyphicon-refresh gly-spin"></i> Waiting for other players...</div>
						<div class="planet"
								ng-repeat="planet in game.universe.planets track by planet.id"
								ng-class="{'friendly': planet.inhabitedByMe, 'enemy': planet.knownAsEnemyPlanet, 'neutral': !planet.inhabitedByMe&&!planet.knownAsEnemyPlanet}"
								ng-click="clickPlanetHandler($index)"
								style="top: {{planet.y / 100 * 334 - 7}}px; left: {{planet.x / 100 * 524 - 8}}px;">
							
							<div class="object-icon">
								<span class="glyphicon glyphicon-globe"></span>
							</div>
							
							<div class="object-annotation object-annotation-top-right" ng-if="planet.myHomePlanet">
								<span class="glyphicon glyphicon-home"></span>
							</div>
							<div class="object-annotation object-annotation-bottom-left" ng-if="planet.incomingShipCount>0">
								<span class="glyphicon glyphicon-share-alt"></span><br/>{{planet.incomingShipCount}}
							</div>
							<div class="object-annotation object-annotation-bottom-right" ng-if="planet.shipCount>0">
								{{planet.shipCount}}
							</div>
						</div>
						<div class="travellingShip friendly-foreground"
								ng-repeat="ships in game.universe.travellingShipFormations"
								ng-hide="ships.distanceTravelled===0"
								style="top: {{ships.positionY / 100 * 334 - 7}}px; left: {{ships.positionX / 100 * 524 - 8}}px;">
							
							<div class="object-icon">
								<span class="glyphicon glyphicon-send"></span>
							</div>
							
							<div class="object-annotation object-annotation-bottom-right" ng-if="ships.shipCount>0">
								{{ships.shipCount}}
							</div>
						</div>
						
						<div class="select-planet-note" ng-show="destinationSelectionActive">
							Select a destination planet...
						</div>
						
						<div class="outer" ng-show="showTurnEvents"><div class="middle">
							<div class="ingame-menu inner form-horizontal">
								<button ng-click="showTurnEvents=false" type="button" class="close"><span>&times;</span></button>
								
								<div ng-show="game.turnNumber === 1">
									<h3>Your mission</h3>
									<ul class="paragraph list-unstyled">
										<li>Find and conquer all enemy home planets!</li>
									</ul>
								</div>
								
								<div ng-show="game.status === 'OVER' && game.me.status === 'PLAYING'" class="friendly-foreground">
									<h3>You win the game!</h3>
									<ul class="paragraph list-unstyled">
										<li>All of your enemies home planets have been conquered!</li>
									</ul>
								</div>
								
								<div ng-show="game.me.status === 'DEFEATED'" class="enemy-foreground">
									<h3>You lose!</h3>
									<ul class="paragraph list-unstyled">
										<li>Your home planet has been conquered by enemy ships.</li>
									</ul>
								</div>
								
								<div ng-show="game.me.status === 'PLAYING' && game.turnNumber > 1">
									<h3>Recent events (Turn {{game.turnNumber - 1}})</h3>
									<ul class="paragraph list-unstyled">
										<li ng-show="!game.previousTurnEvents.hasEvents">No enemy contact</li>
										<li ng-show="game.previousTurnEvents.conqueredEnemyPlanets > 0" class="friendly-foreground">You conquered {{game.previousTurnEvents.conqueredEnemyPlanets}} enemy planets!</li>
										<li ng-show="game.previousTurnEvents.conqueredUninhabitedPlanets > 0" class="friendly-foreground">You inhabited {{game.previousTurnEvents.conqueredUninhabitedPlanets}} uninhabited planets.</li>
										<li ng-show="game.previousTurnEvents.lostShipFormations > 0" class="enemy-foreground">You lost contact to {{game.previousTurnEvents.lostShipFormations}} ship formations that invaded foreign planets!</li>
										<li ng-show="game.previousTurnEvents.defendedPlanets > 0" class="enemy-foreground">{{game.previousTurnEvents.defendedPlanets}} enemy ship formations attacked your planets, but your fleet was able to stand their ground.</li>
										<li ng-show="game.previousTurnEvents.lostPlanets > 0" class="enemy-foreground">Enemy ships conquered {{game.previousTurnEvents.lostPlanets}} of your planets!</li>
									</ul>
								</div>
								<button ng-click="showTurnEvents=false"  class="btn btn-default">Ok</button>
							</div>
						</div></div>
						
						<div class="outer" ng-show="showPlanetMenu"><div class="middle">
							<div class="ingame-menu inner">
								<button ng-click="showPlanetMenu=false" type="button" class="close"><span>&times;</span></button>
								
								<div class="row vert-separated">
									<div class="col-xs-6">
										<div class="form-group">
											<h4>Factories</h4>
										</div>
										<div class="form-group">
											<div class="factory-slot" ng-repeat="i in getNumber(game.universe.planets[selectedPlanetIndex].factorySite.factoryCount) track by $index">
												<img src="resources/img/factory.svg" height="19px" width="19px">
											</div>
											<div class="factory-slot" ng-repeat="i in getNumber(game.universe.planets[selectedPlanetIndex].factorySite.availableSlots) track by $index">
												&nbsp;
											</div>
										</div>
										<div class="form-group">
											<label for="prodFocus">Production/turn</label>
											<div class="row">
												<div class="col-xs-1"><span class="glyphicon glyphicon-usd"></span></div>
												<div class="col-xs-8"><input id="prodFocus" type="range" min="0" max="20" ng-model="productionFocus"ng-change="changeProductionFocusOnSelectedPlanet()"></div>
												<div class="col-xs-1"><span class="glyphicon glyphicon-send"></span></div>
											</div>
											<div>
												Credits: {{game.universe.planets[selectedPlanetIndex].factorySite.producedCreditsPerTurn}}
												-
												Ships: {{game.universe.planets[selectedPlanetIndex].factorySite.producedShipsPerTurn | number: 2}}
											</div>
										</div>
										<div class="form-group">
											<div>
												<button ng-click="buildFactoryOnSelectedPlanet()" ng-disabled="game.universe.planets[selectedPlanetIndex].factorySite.availableSlots===0 || !game.me.canAffordFactory" class="btn btn-default">Build <span class="shortcut">F</span>actory</button>
											</div>
											<div ng-class="{'error-msg': !game.me.canAffordFactory}">
												{{game.me.credits}} / 100 credits
											</div>
										</div>
									</div>
									<div class="col-xs-6">
										<form name="sendShipsForm">
											<div class="form-group">
												<h4>Send ships to other planets</h4>
											</div>
											<div class="form-group row">
												<div class="col-xs-1">1</div>
												<div class="col-xs-8"><input type="range" name="ships" ng-model="shipCount" min="1" max="{{game.universe.planets[selectedPlanetIndex].shipCount}}"></div>
												<div class="col-xs-1">{{game.universe.planets[selectedPlanetIndex].shipCount}}</div>
											</div>
											<div class="form-group">
												<button class="btn btn-default" ng-click="prepareSendShips()" ng-disabled="shipCount===0 || !sendShipsForm.$valid">
													<span class="shortcut">S</span>end {{shipCount}} ships to...
												</button>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div></div>
					</div>
					
					<div class="other-players-status-bar" ng-show="game.otherPlayers.length > 1 || game.otherPlayers[0].humanPlayer">
						<ul class="list-inline">
								<li ng-class="{'enemy-foreground': otherPlayer.status === 'PLAYING' || otherPlayer.status === 'READY' , 'neutral': otherPlayer.status === 'QUIT' || otherPlayer.status === 'DEFEATED'}" ng-repeat="otherPlayer in game.otherPlayers track by otherPlayer.name">
									<span ng-show="otherPlayer.status === 'PLAYING'" class="player-indicator"><i class="glyphicon glyphicon-refresh gly-spin"></i></span>
									<span>{{otherPlayer.name}}</span>
								</li>
							</ul>
					</div>
				</div>
				
				<div id="copyright">&copy; Stefan Pries 2015</div>
			</div>
		</div>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular-touch.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular-cookies.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.0/angular-resource.js"></script>
	<script src="resources/js/controllers.js"></script>
	<script src="resources/js/services.js"></script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		
		ga('create', 'UA-61031970-1', 'auto');
		ga('send', 'pageview');
	</script>
</body>
</html>